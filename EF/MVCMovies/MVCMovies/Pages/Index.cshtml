@page
@model MVCMovies.Pages.HomePageModel
@{
}

<div class="d-flex justify-content-between">
    <div>
        <h3>Recent Reviews</h3>

        <div id="articlesContainer"></div>
    </div>

    <div>
        <h3>Recent Movies</h3>

            <div id = "recentContainer"></div>
    </div>

    <div>
        <h3>Popular Movies</h3>
        <div id="popularContainer"></div>
    </div>
</div>




@section Scripts{
    <script>
        var isBusy = false;
        $(function(){
            $('#articlesContainer').html("<div class='text-center'><i class='fa fa-hurricane fa-spin'></i></div>");
            $('#recentContainer').html("<div class='text-center'><i class='fa fa-hurricane fa-spin'></i></div>");
            $('#popularContainer').html("<div class='text-center'><i class='fa fa-hurricane fa-spin'></i></div>");
            loadArticles();
            loadRecent();
            loadTopRates();
        });

        function loadRecent(){
            $.ajax({
                type: 'GET',
                url: '/api/topMovies',
                dataType: 'json', 
                contentType: 'application/json',
                success: function (articles){
                    //let articles = JSON.parse(data);
                    var html = '';
                    for (var i in articles){
                        //html += '<tr><td>'articles[i].title'</td><td>'articles[i].body'</td></tr>'
                        html += '<div><h4>Title: '+ articles[i].title + '</h4><div class="mb-3">Release date: '+ articles[i].releasedate +'</div></div>'
                    }
                    $('#recentContainer').html(html);
                },
                error: function(data){
                    console.log(data);
                    alert('Ocurrió un error inesperado');
                },
            });
        }

        function loadArticles(){
            $.ajax({
                type: 'GET',
                url: '/api/articles/recentArticles',
                dataType: 'json', 
                contentType: 'application/json',
                success: function (articles){
                    //let articles = JSON.parse(data);
                    var html = '';
                    for (var i in articles){
                        //html += '<tr><td>'articles[i].title'</td><td>'articles[i].body'</td></tr>'
                        html += '<div><h4>Title: '+ articles[i].title + '</h4><div class="mb-3">Body: '+ articles[i].body +'</div><h5>Date: '+ articles[i].publishedat + '</h5></div>'
                    }
                    $('#articlesContainer').html(html);
                },
                error: function(data){
                    console.log(data);
                    alert('Ocurrió un error inesperado');
                },
            });
        }

        function loadTopRates(){
            $.ajax({
                type: 'GET',
                url: '/api/topMovies/rated',
                dataType: 'json', 
                contentType: 'application/json',
                success: function (articles){
                    //let articles = JSON.parse(data);
                    var html = '';
                    for (var i in articles){
                        //html += '<tr><td>'articles[i].title'</td><td>'articles[i].body'</td></tr>'
                        html += '<div><h4>Title: '+ articles[i].title + '</h4><div class="mb-3">Stars: '+ articles[i].rates +'</div></div>'
                    }
                    $('#popularContainer').html(html);
                },
                error: function(data){
                    console.log(data);
                    alert('Ocurrió un error inesperado');
                },
            });
        }

    </script>
}